name: Validate System

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master, develop ]

jobs:
  validate:
    runs-on: ubuntu-latest
    
    permissions:
      contents: read
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3
      
    - name: ğŸ”§ Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: ğŸ“¦ Install dependencies
      run: |
        if [ -f package.json ]; then
          npm ci || npm install
        fi
        
    - name: âœ… Validate JavaScript syntax
      run: |
        echo "ğŸ” Checking JavaScript files..."
        node --check js/proposta.js
        node --check js/supabase-config.js
        node --check js/utils.js
        node --check js/script.js
        echo "âœ… All JavaScript files are valid"
        
    - name: ğŸ” Run validation tests
      run: |
        if [ -f tests/validate.js ]; then
          node tests/validate.js
        else
          echo "âš ï¸  No validation tests found, skipping..."
        fi
        
    - name: ğŸ“Š Check file structure
      run: |
        echo "ğŸ“ Checking required files..."
        test -f index.html && echo "âœ… index.html" || echo "âŒ index.html missing"
        test -f config.html && echo "âœ… config.html" || echo "âŒ config.html missing"
        test -f database-schema.sql && echo "âœ… database-schema.sql" || echo "âŒ database-schema.sql missing"
        test -d js && echo "âœ… js/ directory" || echo "âŒ js/ directory missing"
        test -d css && echo "âœ… css/ directory" || echo "âŒ css/ directory missing"
        
    - name: ğŸ‰ Success
      run: |
        echo "âœ… All validations passed!"
        echo "ğŸš€ System is ready for deployment"
